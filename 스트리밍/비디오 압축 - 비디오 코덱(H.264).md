# 비디오 압축 - 비디오 코덱(H.264)

### 비디오 코덱

- 코덱이란, 데이터 스트림과 신호를 인코딩/디코딩하는 프로그램이다.

  - 일반적으로 영상, 음성 등 미디어 정보를 압축하는 기술이다.

- 비디오 코덱은 디지털 영상의 압축/압축해제 하는 기능의 하드웨어, 소프트웨어를 말한다.

- 인코딩(Encoding) : 코덱에서 데이터를 압축하는 작업

- 인코더(Encoder) : 인코딩하는 기능을 하는 소프트웨어 (혹은 하드웨어)

- 디코더(Decoding) : 압축된 데이터를 푸는 작업

- 디코더(Decoder) : 디코딩하는 기능을 하는 소프트웨어 (혹은 하드웨어)

<img width="762" alt="image" src="https://github.com/user-attachments/assets/60989a00-35cb-4061-a0e7-7213776b4e36">

### 비디오 코덱 – H.264/AVC

- ITU-T, ISO/IEC 그룹으로부터 개발된 코덱으로, MPEG-4 Part 10이라고도 불린다.

- H.262, H.263 보다 압축률이 높다.

  - 압축률이 높다는 것은 같은 화질을 유지하면서도 더 적은 데이터로 비디오를 저장하거나 전송할 수 있다는 뜻이다.

- 네트워크를 통한 전송에 최적화된 비디오 코덱이다.

  - 스트리밍이나 비디오 통신 같은 네트워크 환경에서 효율적으로 작동하도록 설계되었다.

  - 네트워크 패킷 손실을 보완하거나, 네트워크 지연에 강하게 설계되어 있어 끊김 없이 재생될 수 있다.

- 오늘날 대다수의 디바이스 및 웹 브라우저에서 지원하는 코덱이다.

### H.264 – Profile, Level

- 프로파일(Profile)은 여러 비디오 부호화 기술을 사용 영역에 맞게 특정 기술들만 사용할 수 있도록 설정한 것을 말한다.

  - 비디오 인코딩 시 사용할 수 있는 기능을 정의하며, 프로파일에 따라 비디오의 압축 효율, 품질, 그리고 디코딩 복잡도가 달라진다.

- 각 프로파일은 서로 다른 용도와 장치에 맞게 최적화되어 있으며, 비디오 품질과 효율성 간의 균형을 다르게 맞추기 위해 다양한 프로파일이 존재한다.

  - **Baseline Profile** : 가장 기본적인 프로파일로, 복잡도가 낮고 주로 저전력 장치나 실시간 통신에서 사용된다.

    - 인터레이스 비디오 지원 X: 인터레이스 형식(예: TV 방송용)을 지원하지 않는다.

    - 에러 복구 기능: 네트워크 환경에서 에러 복구가 중요한 실시간 영상에서 사용될 수 있도록 간단한 에러 복구 기능을 지원한다.

    - 용도: 비디오 회의, 모바일 영상 통신 등에서 사용된다.

    - 장점: 낮은 복잡도 덕분에 저사양 디바이스에서 효율적으로 작동한다.

  - **Main Profile** : Baseline Profile보다 복잡도가 높고, 더 나은 비디오 품질과 효율을 제공. 특히 인터레이스 비디오를 지원한다.

    - B-프레임 지원: B-프레임을 지원하여 압축 효율을 높인다.

    - 인터레이스 비디오 지원: TV 방송과 같은 전통적인 인터레이스 형식을 지원하여 더 넓은 응용 범위를 가졌다.

    - 용도: SD/HD 방송, 스트리밍 서비스 등에서 사용한다.

    - 장점: 방송 및 스트리밍 환경에 적합하며, 네트워크 대역폭을 절약하면서 좋은 화질을 유지한다.

  - **High Profile** : H.264의 가장 고급 프로파일 중 하나로, 최고의 압축 효율과 화질을 제공하며, Main Profile에 비해 추가적인 압축 도구를 사용하여 더욱 뛰어난 성능을 발휘한다.

    - CABAC(Context-Adaptive Binary Arithmetic Coding) 압축 기법을 지원하여 압축 효율을 더욱 높인다.

    - 8x8 트랜스폼과 더 높은 비트 깊이 지원으로, 비디오의 세부 정보와 품질을 더 잘 유지한다.

    - 용도: Blu-ray 디스크, 고해상도 비디오 스트리밍, 4K 영상 등 고화질 비디오에 사용한다.

    - 장점: 최고의 압축 성능과 고화질을 요구하는 애플리케이션에 적합하다.

  - **Extended Profile** : Baseline과 Main Profile의 기능을 결합한 프로파일로, 영상 회복과 오류 복구 기능이 향상된다.

    - 추가적인 에러 복구 기능을 제공하며, 실시간 스트리밍에 적합한 기능이 추가되었다.

    - 하지만 이 프로파일은 실질적으로는 많이 사용되지 않는다.

    - 용도: 영상 회복이 중요한 스트리밍 서비스나 모바일 비디오에서 주로 사용될 수 있다.

<img width="721" alt="image" src="https://github.com/user-attachments/assets/2dd84eaa-5998-418b-9167-7962476d3ccb">

- H.264 프로파일은 인코딩 시의 성능과 디코딩 장치의 처리 능력에 영향을 미친다. 예를 들어, 저사양 장치에서는 Baseline Profile이 적합하며, 고사양 장치나 고화질 스트리밍을 지원하는 환경에서는 High Profile이 선호된다.

  - 프로파일이 복잡할수록 압축 효율이 높고 화질이 좋아지지만, 디코딩하는 데 요구되는 리소스도 증가합니다.

  - 따라서, H.264 비디오를 인코딩할 때는 대상 장치와 네트워크 환경에 맞춰 적절한 프로파일을 선택하는 것이 중요하다.

### H.264 – NAL Structure

- H.264 데이터 스트림은 여러 개의 **NAL(Network Abstraction Layer) Unit** 으로 구성되어 있다.

- 부호화가 완료된 비디오 데이터는 정수 개의 바이트 단위인 NAL Unit으로 패킷화 된다.

- NAL의 첫 번째 바이트는 데이터 형을 나타내는 헤더다. (0x00 00 01 혹은 0x00 00 00 01)

  - 이 헤더 값과 다음 헤더 값 사이에 있는 값이 일반적으로 1개의 NAL Unit 데이터다.

- VCL NAL Unit : 비디오 데이터를 포함한다.

- Non-VCL NAL Unit : Parameter나 enhancement 정보를 위한 보조 데이터다.

### H.264 – NAL Unit 종류

<img width="737" alt="image" src="https://github.com/user-attachments/assets/91d5dd6f-f962-4c46-8b20-25ce03db3b00">

- **IDR picture** : Instantaneous Decoding Refresh Picture

  - 프레임 번호(Picture Order Count), 참조 픽쳐 번호 초기화

  - 즉, Reference 이미지를 사용하지 않고 독자적으로 디코딩될 수 있는 I-Frame을 말한다.

  - 키 프레임을 가리킨다.

- **non-IDR picture** : I/P/B-Frame을 말한다.

  - non-IDR이면서 I-Frame은 키 프레임이 될 수 없다.

- **Parameter Sets**

  - **Sequential Parameter Sets (SPS)** : Profile, Level 등 시퀀스 전체의 부호화에 걸쳐있는
    정보가 포함되어 있는 헤더 정보다.

  - **Picture Parameter Sets (PPS)** : 픽처 전체의 부호화 모드를 나타내는 헤더 정보다.

  - SPS와 PPS의 분리로 Robustness(견고성)가 증가한다.,

    - Robustness를 위해 SPS와 PPS를 반복적으로 전송 가능하다.

- **Access Units** : 엑세스 단위의 선두를 표시하는 정보다.

  - 엑세스 단위에 포함된 슬라이스의 종류를 표시하는 정보가 포함된다.

<img width="814" alt="image" src="https://github.com/user-attachments/assets/e2ced314-428c-4202-9164-5cfc060af16e">

- 위는 N = 5인 스트림의 NAL Unit 목록이다.
